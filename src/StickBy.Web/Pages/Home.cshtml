@page
@model HomeModel
@inject ILocalizationService L
@{
    ViewData["Title"] = L["home.title"];
}

<div class="page-header">
    <h1 class="page-title">@L["home.title"]</h1>
</div>

@if (Model.PendingInvitations.Any())
{
    <section class="home-section">
        <h2>@L["home.contactRequests"]</h2>
        <div class="invitation-list">
            @foreach (var invitation in Model.PendingInvitations)
            {
                <div class="invitation-card">
                    <div class="invitation-info">
                        <div class="avatar small">@invitation.Name[0]</div>
                        <div>
                            <div class="invitation-name">@invitation.Name</div>
                            <div class="invitation-detail">@L["groups.invite"]</div>
                        </div>
                    </div>
                    <div class="invitation-actions">
                        <form method="post" asp-page-handler="Accept" asp-route-id="@invitation.Id" style="display:inline">
                            <button type="submit" class="btn-primary">@L["common.confirm"]</button>
                        </form>
                        <form method="post" asp-page-handler="Decline" asp-route-id="@invitation.Id" style="display:inline">
                            <button type="submit" class="btn-secondary">@L["common.cancel"]</button>
                        </form>
                    </div>
                </div>
            }
        </div>
    </section>
}

<section class="home-section">
    <h2>@L["home.recentActivity"]</h2>

    @if (Model.RecentShares.Any())
    {
        <div class="activity-list">
            @foreach (var share in Model.RecentShares.OrderByDescending(s => s.CreatedAt).Take(10))
            {
                <div class="activity-item">
                    <div class="activity-icon @(share.ViewCount > 0 ? "viewed" : "")">
                        @if (share.ViewCount > 0)
                        {
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                        }
                        else
                        {
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
                                <polyline points="16 6 12 2 8 6"/>
                                <line x1="12" y1="2" x2="12" y2="15"/>
                            </svg>
                        }
                    </div>
                    <div class="activity-content">
                        <div class="activity-header">
                            <span class="activity-title">@(string.IsNullOrEmpty(share.Name) ? L["home.unnamedShare"] : share.Name)</span>
                            <span class="activity-time">@FormatDate(share.CreatedAt)</span>
                        </div>
                        <div class="activity-details">
                            <span class="activity-stat">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                    <circle cx="9" cy="7" r="4"/>
                                </svg>
                                @share.ContactIds.Count @L["home.contacts"]
                            </span>
                            <span class="activity-stat">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                                @share.ViewCount @L["home.views"]
                            </span>
                            @if (share.ExpiresAt.HasValue)
                            {
                                <span class="activity-stat @(share.ExpiresAt < DateTime.UtcNow ? "expired" : "")">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <polyline points="12 6 12 12 16 14"/>
                                    </svg>
                                    @if (share.ExpiresAt < DateTime.UtcNow)
                                    {
                                        @L["home.expired"]
                                    }
                                    else
                                    {
                                        @FormatDate(share.ExpiresAt.Value)
                                    }
                                </span>
                            }
                        </div>
                    </div>
                    <a href="~/Shares" class="activity-link">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 18 15 12 9 6"/>
                        </svg>
                    </a>
                </div>
            }
        </div>
        <a href="~/Shares" class="view-all-link">@L["home.viewAllShares"]</a>
    }
    else
    {
        <div class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
                <polyline points="16 6 12 2 8 6"/>
                <line x1="12" y1="2" x2="12" y2="15"/>
            </svg>
            <h3>@L["home.noActivity"]</h3>
            <p>@L["home.noActivityHint"]</p>
            <a href="~/Contacts" class="btn-primary">@L["home.createShare"]</a>
        </div>
    }
</section>

@functions {
    private string FormatDate(DateTime date)
    {
        var diff = DateTime.UtcNow - date;
        if (diff.TotalMinutes < 60) return $"{(int)diff.TotalMinutes}m";
        if (diff.TotalHours < 24) return $"{(int)diff.TotalHours}h";
        if (diff.TotalDays < 7) return $"{(int)diff.TotalDays}d";
        return date.ToString("dd.MM.yyyy");
    }
}

<style>
    .home-section {
        margin-bottom: 2rem;
    }
    .home-section h2 {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 1rem;
    }
    .activity-list {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }
    .activity-item {
        display: flex;
        align-items: center;
        gap: 0.875rem;
        padding: 1rem;
        background: var(--surface);
        border-radius: 0.5rem;
        border: 1px solid var(--border);
    }
    .activity-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--background);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-muted);
        flex-shrink: 0;
    }
    .activity-icon.viewed {
        background: rgba(34, 197, 94, 0.1);
        color: var(--success-color);
    }
    .activity-content {
        flex: 1;
        min-width: 0;
    }
    .activity-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.375rem;
    }
    .activity-title {
        font-weight: 500;
        font-size: 0.9375rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .activity-time {
        font-size: 0.75rem;
        color: var(--text-muted);
        flex-shrink: 0;
    }
    .activity-details {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
    }
    .activity-stat {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        font-size: 0.75rem;
        color: var(--text-muted);
    }
    .activity-stat.expired {
        color: var(--danger-color);
    }
    .activity-link {
        color: var(--text-muted);
        padding: 0.25rem;
    }
    .activity-link:hover {
        color: var(--primary-color);
    }
    .view-all-link {
        display: block;
        text-align: center;
        padding: 0.75rem;
        margin-top: 0.75rem;
        color: var(--primary-color);
        text-decoration: none;
        font-size: 0.875rem;
        font-weight: 500;
    }
    .view-all-link:hover {
        text-decoration: underline;
    }
    .invitation-list {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }
    .invitation-card {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background: var(--surface);
        border-radius: 0.5rem;
        border: 1px solid var(--border);
    }
    .invitation-info {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    .invitation-name {
        font-weight: 500;
    }
    .invitation-detail {
        font-size: 0.75rem;
        color: var(--text-muted);
    }
    .invitation-actions {
        display: flex;
        gap: 0.5rem;
    }
    .avatar.small {
        width: 36px;
        height: 36px;
        font-size: 0.875rem;
    }
</style>
